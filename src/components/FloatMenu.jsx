import React, { useState, useEffect, useRef } from 'react';
import '../styles/FloatMenu.css';

/**
 * 悬浮菜单组件
 * 在页面右下角显示一个可展开的悬浮按钮组
 */
const FloatMenu = () => {
  const [isOpen, setIsOpen] = useState(false);
  const menuRef = useRef(null);

  /**
   * 切换菜单展开状态
   */
  const toggleMenu = () => {
    setIsOpen(!isOpen);
  };

  /**
   * 关闭菜单
   */
  const closeMenu = () => {
    setIsOpen(false);
  };

  /**
   * 监听点击外部区域关闭菜单
   */
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (menuRef.current && !menuRef.current.contains(event.target) && isOpen) {
        closeMenu();
      }
    };

    // 添加事件监听器
    document.addEventListener('mousedown', handleClickOutside);

    // 清理事件监听器
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [isOpen]);

  /**
   * 处理菜单项点击事件
   * @param {string} action - 点击的菜单项类型
   */
  const handleMenuClick = (action) => {
    console.log(`点击了${action}按钮`);
    // 这里可以添加具体的功能逻辑
    switch (action) {
      case 'recharge':
        // 充值功能
        break;
      case 'question':
        // 问号功能 - 帮助或FAQ
        break;
      case 'cart':
        // 购物车功能
        break;
      case 'plus':
        // 添加功能
        break;
      default:
        break;
    }
  };

  return (
    <div ref={menuRef} className={`float-btn-group ${isOpen ? 'open' : ''}`}>
      <div className="float-btn-group-wrap">
        {/* 菜单项按钮容器 */}
        <div className="float-btn-items-container">
          <button
            className="float-btn float-btn-item float-btn-first"
            onClick={() => handleMenuClick('question')}
          >
            <div className="float-btn-body">
              <div className="float-btn-content">
                <div className="float-btn-icon">
                  <svg viewBox="64 64 896 896" width="1em" height="1em" fill="currentColor">
                    <path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"></path>
                    <path d="M623.6 316.7C593.6 290.4 554 276 512 276s-81.6 14.5-111.6 40.7C369.2 344 352 380.7 352 420v7.6c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V420c0-44.1 43.1-80 96-80s96 35.9 96 80c0 31.1-22 59.6-56.1 72.7-21.2 8.1-39.2 22.3-52.1 40.9-13.1 19-19.9 41.8-19.9 64.9V620c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-22.7a48.3 48.3 0 0130.9-44.8c59-22.7 97.1-74.7 97.1-132.5.1-39.3-17.1-76-48.3-103.3zM472 732a40 40 0 1080 0 40 40 0 10-80 0z"></path>
                  </svg>
                </div>
              </div>
            </div>
          </button>

          <button
            className="float-btn float-btn-item float-btn-middle"
            onClick={() => handleMenuClick('recharge')}
          >
            <div className="float-btn-body">
              <div className="float-btn-content">
                <div className="float-btn-icon">
                  <svg width="20" height="20" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M512.00256 119.42682c216.472374 0 392.584955 176.115652 392.584955 392.590074 0 216.455992-176.113604 392.556286-392.584955 392.556286-216.475446 0-392.590074-176.100293-392.590074-392.556286C119.411462 295.541448 295.527114 119.42682 512.00256 119.42682M512.00256 72.54995c-242.239653 0-439.466944 197.105448-439.466944 439.466944 0 242.356377 197.193503 439.432132 439.466944 439.432132 242.326684 0 439.460801-197.075755 439.460801-439.432132C951.46336 269.656422 754.357912 72.54995 512.00256 72.54995L512.00256 72.54995z" fill="currentColor"/>
                    <path d="M719.115533 334.755507c11.797289 0 18.98911 6.575438 21.633824 19.668975-1.324917 11.802409-7.866566 18.377846-19.668975 19.668975L487.030846 374.093456c-26.240317 35.402107-61.646519 71.477935-106.205296 108.172194l-3.935843 3.935843c0 1.319797 1.969969 1.965874 5.900692 1.965874 89.152367 0 175.693808-3.257002 259.615108-9.833463-18.373751-24.890826-35.399035-45.238642-51.136263-60.971774-7.866566-9.157694-7.866566-18.343034 0-27.535541 10.478516-9.157694 20.314027-9.157694 29.50039 0 18.349177 18.377846 53.75026 62.292595 106.210416 131.775988 6.541649 11.802409 5.221852 22.312665-3.935843 31.47036-9.191483 6.575438-18.377846 4.610588-27.535541-5.900692-5.256664-6.546769-11.157356-13.767258-17.703101-21.633824-3.930723-3.935843-6.575438-7.192845-7.866566-9.83244-15.733132 1.319797-36.076852 2.639595-60.972798 3.930723-11.797289 1.323893-20.988772 1.969969-27.535541 1.969969l0 159.310504c1.295224 15.733132 11.802409 24.245774 31.47036 25.565572l55.071082 0c24.890826 3.935843 36.692211-17.02426 35.402107-62.936624 1.291128-13.088418 8.511618-20.309931 21.633824-21.633824 11.802409 1.323893 18.348153 8.545407 19.668975 21.633824 3.930723 76.030161-20.34372 110.141139-72.773159 102.274573l-68.839364 0c-40.656723-1.319797-62.291571-19.668975-64.902497-55.070058L538.161989 523.567425c-24.919495 2.64369-52.459132 3.935843-82.605598 3.935843-1.319797 110.141139-51.135239 180.944329-149.473969 212.410593-13.12323 5.225947-21.633824 2.616045-25.565572-7.86247-3.935843-13.126302-0.678841-22.957717 9.83244-29.50551 78.669756-23.599698 119.29781-81.926758 121.938428-175.043636l-68.83834 0c-17.053953 0-28.210286-4.576799-33.436233-13.767258-3.930723-10.478516 0.645052-20.960103 13.767258-31.467288 41.951947-32.761488 79.96498-68.83834 114.075958-108.175266L302.155794 374.092432c-11.802409 0-18.377846-6.541649-19.668975-19.668975 1.291128-11.797289 7.866566-18.343034 19.668975-19.668975l177.008486 0c-1.319797-2.609902-3.935843-7.86247-7.866566-15.733132l-5.900692-11.797289c-6.575438-10.482611-4.610588-19.668975 5.900692-27.535541 10.482611-5.225947 19.668975-2.616045 27.535541 7.866566 5.225947 7.866566 13.767258 23.599698 25.569667 47.199396L719.115533 334.754483 719.115533 334.755507 719.115533 334.755507zM719.115533 334.755507" fill="currentColor"/>
                  </svg>
                </div>
              </div>
            </div>
          </button>

          <button
            className="float-btn float-btn-item float-btn-middle"
            onClick={() => handleMenuClick('cart')}
          >
            <div className="float-btn-body">
              <div className="float-btn-content">
                <div className="float-btn-icon">
                  <svg viewBox="0 0 1024 1024" width="1em" height="1em" fill="currentColor">
                    <path d="M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"></path>
                  </svg>
                </div>
              </div>
            </div>
          </button>

          <button
            className="float-btn float-btn-item float-btn-last"
            onClick={() => handleMenuClick('plus')}
          >
            <div className="float-btn-body">
              <div className="float-btn-content">
                <div className="float-btn-icon">
                  <svg viewBox="64 64 896 896" width="1em" height="1em" fill="currentColor">
                    <path d="M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"></path>
                    <path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"></path>
                  </svg>
                </div>
              </div>
            </div>
          </button>
        </div>
      </div>

      {/* 主触发按钮 */}
      <button className="float-btn float-btn-trigger" onClick={toggleMenu}>
        <div className="float-btn-body">
          <div className="float-btn-content">
            <div className="float-btn-icon">
              {isOpen ? (
                <svg fill-rule="evenodd" viewBox="64 64 896 896" focusable="false" data-icon="close" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z"></path></svg>
              ) : (
                <svg viewBox="64 64 896 896" focusable="false" data-icon="expand-alt" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M855 160.1l-189.2 23.5c-6.6.8-9.3 8.8-4.7 13.5l54.7 54.7-153.5 153.5a8.03 8.03 0 000 11.3l45.1 45.1c3.1 3.1 8.2 3.1 11.3 0l153.6-153.6 54.7 54.7a7.94 7.94 0 0013.5-4.7L863.9 169a7.9 7.9 0 00-8.9-8.9zM416.6 562.3a8.03 8.03 0 00-11.3 0L251.8 715.9l-54.7-54.7a7.94 7.94 0 00-13.5 4.7L160.1 855c-.6 5.2 3.7 9.5 8.9 8.9l189.2-23.5c6.6-.8 9.3-8.8 4.7-13.5l-54.7-54.7 153.6-153.6c3.1-3.1 3.1-8.2 0-11.3l-45.2-45z"></path></svg>
              )}
            </div>
            <div className="float-btn-description">菜单</div>
          </div>
        </div>
      </button>
    </div>
  );
};

export default FloatMenu;